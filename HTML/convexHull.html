<html>
<head>
  <title>Convex Hulls</title>
  <meta charset="utf-8" />
    <link type="text/css" rel="stylesheet" href="d3map3.css" />
</head>
<style>
  html,body {
    height: 100%;
    width: 100%;
    margin: 0;
  }

  #map {
    height: 100%;
    width: 100%;
    position: absolute;
  }
  .cityhull {
    fill: purple;
    fill-opacity: .5;
    stroke: black;
    stroke-width: 1px;
  }
  
  .point {
    fill: darkred;
    stroke: black;
    stroke-width: 1px;
  }

</style>
<script>
      function makeSomeMaps() {
    map = d3.carto.map();

    d3.select("#map").call(map);
    
    tileLayer = d3.carto.layer();
    tileLayer
    .type("tile")
    .path("elijahmeeks.map-azn21pbi")
    .label("Base")

    csvLayer = d3.carto.layer.csv();
    csvLayer
    .path("STTLCoordsCSV")
    .label("CSV Points")
    .cssClass("point")
    .renderMode("canvas")
    .markerSize(1)
    .x("lon")
    .y("lat")
    .on("load", makeHull)
    .clickableFeatures(true);

    map.addCartoLayer(tileLayer)
    .addCartoLayer(csvLayer);
    map.centerOn([44.361488,33.312806],"latlong").setScale(2);

        function makeHull() {
          hullLayer = map.createHullLayer(csvLayer, function(d) {return d.region});
          hullLayer.markerSize(1).cssClass("cityhull")
          .on("load", recolorHulls)
          map.addCartoLayer(hullLayer);
          
          function recolorHulls() {
            var hullColor = d3.scale.category20b();
              hullLayer.g()
              .selectAll("path")
              .style("fill", function(d,i) {return hullColor(i%20)});
          }
    }

  }
  
</script>
<body onload="makeSomeMaps()">
<div id="map"></div>
<footer>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8" type="text/javascript"></script>
<script src="http://d3js.org/topojson.v1.min.js" type="text/javascript">
</script>
<script src="http://bl.ocks.org/emeeks/raw/f3105fda25ff785dc5ed/tile.js" type="text/javascript">
</script>
<script src="https://rawgit.com/emeeks/d3-carto-map/master/d3.carto.map.js" type="text/javascript">
</script>
</footer>
</body>
</html>
